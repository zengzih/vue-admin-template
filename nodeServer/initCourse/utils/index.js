const fs = require('fs');
const path = require('path');
const request = require("request");
const cheerio = require("cheerio");
const base64StrToFont = (base64Str)=> {
	const buffer = Buffer.from(base64Str, 'base64');
	const filePath = path.resolve(__dirname, 'baseFont.ttf');
	return new Promise((resolve, reject) => {
		fs.writeFile(filePath, buffer, (err)=> {
			if (!err) {
				return resolve(filePath);
			}
			reject(false)
		});
	})
}
/*
const str = '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SElaVUtBIChrYW5hICYgaWRlb2dyYXBocyk7IFBhdWwgRC4gSHVudCAoTGF0aW4sIEdyZWVrICYgQ3lyaWxsaWMpOyBXZW5sb25nIFpIQU5HIChib3BvbW9mbyk7IFNhbmRvbGwgQ29tbXVuaWNhdGlvbiwgU29vLXlvdW5nIEpBTkcgJiBKb28teWVvbiBLQU5HIChoYW5ndWwgZWxlbWVudHMsIGxldHRlcnMgJiBzeWxsYWJsZXMpRHIuIEtlbiBMdW5kZSAocHJvamVjdCBhcmNoaXRlY3QsIGdseXBoIHNldCBkZWZpbml0aW9uICYgb3ZlcmFsbCBwcm9kdWN0aW9uKTsgTWFzYXRha2EgSEFUVE9SSSAocHJvZHVjdGlvbiAmIGlkZW9ncmFwaCBlbGVtZW50cylodHRwOi8vd3d3LmFkb2JlLmNvbS90eXBlL0NvcHlyaWdodCA/MjAxNCBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZCAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0IGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMC5odG1sICBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLiAgAEMAbwBwAHkAcgBpAGcAaAB0ACAAqQAgADIAMAAxADQAIABBAGQAbwBiAGUAIABTAHkAcwB0AGUAbQBzACAASQBuAGMAbwByAHAAbwByAGEAdABlAGQALgAgAEEAbABsACAAUgBpAGcAaAB0AHMAIABSAGUAcwBlAHIAdgBlAGQALgBTAG8AdQByAGMAZQAgAEgAYQBuACAAUwBhAG4AcwAgAEMATgAgAE4AbwByAG0AYQBsADEALgAwADAAMAA7AEEARABCAEUAOwBTAG8AdQByAGMAZQBIAGEAbgBTAGEAbgBzAEMATgAtAE4AbwByAG0AYQBsADsAQQBEAE8AQgBFAFYAZQByAHMAaQBvAG4AIAAxAC4AMAAwADAAOwBQAFMAIAAxADsAaABvAHQAYwBvAG4AdgAgADEALgAwAC4ANwA4ADsAbQBhAGsAZQBvAHQAZgAuAGwAaQBiADIALgA1AC4ANgAxADkAMwAwAFMAbwB1AHIAYwBlACAAaQBzACAAYQAgAHQAcgBhAGQAZQBtAGEAcgBrACAAbwBmACAAQQBkAG8AYgBlACAAUwB5AHMAdABlAG0AcwAgAEkAbgBjAG8AcgBwAG8AcgBhAHQAZQBkACAAaQBuACAAdABoAGUAIABVAG4AaQB0AGUAZAAgAFMAdABhAHQAZQBzACAAYQBuAGQALwBvAHIAIABvAHQAaABlAHIAIABjAG8AdQBuAHQAcgBpAGUAcwAuAFIAeQBvAGsAbwAgAE4ASQBTAEgASQBaAFUASwBBACCJf1habbxbUAAgACgAawBhAG4AYQAgACYAIABpAGQAZQBvAGcAcgBhAHAAaABzACkAOwAgAFAAYQB1AGwAIABEAC4AIABIAHUAbgB0ACAAKABMAGEAdABpAG4ALAAgAEcAcgBlAGUAawAgACYAIABDAHkAcgBpAGwAbABpAGMAKQA7ACAAVwBlAG4AbABvAG4AZwAgAFoASABBAE4ARwAgXyBlh5+ZACAAKABiAG8AcABvAG0AbwBmAG8AKQA7ACAAUwBhAG4AZABvAGwAbAAgAEMAbwBtAG0AdQBuAGkAYwBhAHQAaQBvAG4AIMCws8zO5LukssjPAMd0wVgALAAgAFMAbwBvAC0AeQBvAHUAbgBnACAASgBBAE4ARwAgx6XCGMYBACAAJgAgAEoAbwBvAC0AeQBlAG8AbgAgAEsAQQBOAEcAIKwVyPzF8AAgACgAaABhAG4AZwB1AGwAIABlAGwAZQBtAGUAbgB0AHMALAAgAGwAZQB0AHQAZQByAHMAIAAmACAAcwB5AGwAbABhAGIAbABlAHMAKQBEAHIALgAgAEsAZQBuACAATAB1AG4AZABlACAAKABwAHIAbwBqAGUAYwB0ACAAYQByAGMAaABpAHQAZQBjAHQALAAgAGcAbAB5AHAAaAAgAHMAZQB0ACAAZABlAGYAaQBuAGkAdABpAG8AbgAgACYAIABvAHYAZQByAGEAbABsACAAcAByAG8AZAB1AGMAdABpAG8AbgApADsAIABNAGEAcwBhAHQAYQBrAGEAIABIAEEAVABUAE8AUgBJACBnDZDoa2OMtAAgACgAcAByAG8AZAB1AGMAdABpAG8AbgAgACYAIABpAGQAZQBvAGcAcgBhAHAAaAAgAGUAbABlAG0AZQBuAHQAcwApAGgAdAB0AHAAOgAvAC8AdwB3AHcALgBhAGQAbwBiAGUALgBjAG8AbQAvAHQAeQBwAGUALwBDAG8AcAB5AHIAaQBnAGgAdAAgAKkAIAAyADAAMQA0ACAAQQBkAG8AYgBlACAAUwB5AHMAdABlAG0AcwAgAEkAbgBjAG8AcgBwAG8AcgBhAHQAZQBkAA0ACgBMAGkAYwBlAG4AcwBlAGQAIAB1AG4AZABlAHIAIAB0AGgAZQAgAEEAcABhAGMAaABlACAATABpAGMAZQBuAHMAZQAsACAAVgBlAHIAcwBpAG8AbgAgADIALgAwACAAKAB0AGgAZQAgACIATABpAGMAZQBuAHMAZQAiACkAOwAgAHkAbwB1ACAAbQBhAHkAIABuAG8AdAAgAHUAcwBlACAAdABoAGkAcwAgAGYAaQBsAGUAIABlAHgAYwBlAHAAdAAgAGkAbgAgAGMAbwBtAHAAbABpAGEAbgBjAGUAIAB3AGkAdABoACAAdABoAGUAIABMAGkAYwBlAG4AcwBlAC4AIABZAG8AdQAgAG0AYQB5ACAAbwBiAHQAYQBpAG4AIABhACAAYwBvAHAAeQAgAG8AZgAgAHQAaABlACAATABpAGMAZQBuAHMAZQAgAGEAdAAgAGgAdAB0AHAAOgAvAC8AdwB3AHcALgBhAHAAYQBjAGgAZQAuAG8AcgBnAC8AbABpAGMAZQBuAHMAZQBzAC8ATABJAEMARQBOAFMARQAtADIALgAwAC4AaAB0AG0AbAANAAoAVQBuAGwAZQBzAHMAIAByAGUAcQB1AGkAcgBlAGQAIABiAHkAIABhAHAAcABsAGkAYwBhAGIAbABlACAAbABhAHcAIABvAHIAIABhAGcAcgBlAGUAZAAgAHQAbwAgAGkAbgAgAHcAcgBpAHQAaQBuAGcALAAgAHMAbwBmAHQAdwBhAHIAZQAgAGQAaQBzAHQAcgBpAGIAdQB0AGUAZAAgAHUAbgBkAGUAcgAgAHQAaABlACAATABpAGMAZQBuAHMAZQAgAGkAcwAgAGQAaQBzAHQAcgBpAGIAdQB0AGUAZAAgAG8AbgAgAGEAbgAgACIAQQBTACAASQBTACIAIABCAEEAUwBJAFMALAAgAFcASQBUAEgATwBVAFQAIABXAEEAUgBSAEEATgBUAEkARQBTACAATwBSACAAQwBPAE4ARABJAFQASQBPAE4AUwAgAE8ARgAgAEEATgBZACAASwBJAE4ARAAsACAAZQBpAHQAaABlAHIAIABlAHgAcAByAGUAcwBzACAAbwByACAAaQBtAHAAbABpAGUAZAAuACAAUwBlAGUAIAB0AGgAZQAgAEwAaQBjAGUAbgBzAGUAIABmAG8AcgAgAHQAaABlACAAcwBwAGUAYwBpAGYAaQBjACAAbABhAG4AZwB1AGEAZwBlACAAZwBvAHYAZQByAG4AaQBuAGcAIABwAGUAcgBtAGkAcwBzAGkAbwBuAHMAIABhAG4AZAAgAGwAaQBtAGkAdABhAHQAaQBvAG4AcwAgAHUAbgBkAGUAcgAgAHQAaABlACAATABpAGMAZQBuAHMAZQAuAA0ACgBSAGUAZwB1AGwAYQByYB1ukJ7RT1MAIABDAE4AIABOAG8AcgBtAGEAbAAAAAADAAAAAAAA/4MAMgAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAIAEQABAAWAARpY2ZiaWNmdGlkZW9yb21uAAZERkxUAGJjeXJsAGhncmVrAGhoYW5pAGJrYW5hAGJsYXRuAGgABAAWAARpY2ZiaWNmdGlkZW9yb21uAAZERkxUADJjeXJsADhncmVrADhoYW5pADJrYW5hADJsYXRuADgAGAAAAAAAHgAAAAAAJAAAAAAAKgAAAAAAAgAEADAANAA4ADwAAwAEACQAKAAsADAAAgAEACgALAAkADAAAwAEABwAIAAYACQAAf+4AAEDQAAB/4gAAQAAAAEAMAABA7gAAQB4AAEAAANwANsB2gNiAeoDYgHrA2kB7ANiAe4CiwHvA4EB8gNhAfQDaAH1A1oB9gPSAfkDYgH6A2EB+wNhAfwDYQH9A2EB/gNhAf8DYQIAA2ECAQNhAgIDYQIDA2ECBANhAgUDYQIKAwECDwMBArUDUQK2A1gCtwNYArgDUQK5A1ECugNYArsDUQK8A1gCvQNYAr4DWAK/A1ECwANYAsEDWALCA1ECwwNRAsQDWALFA1ECxgNYAscDWALIA1gEnAVkBJ0FZAcYAugHGQKOBxoDXAcbA2IHvQNcB78DXAfAAp4HwgOhB8MDoQfEA1wHygL4B8sDYgfMAvoHzQNiB88DYgfQA2IH0QNiB9QC+AfVA2IH1gL6B9cCjgfYAo4H2QL5B9oDYgfcA2IH3QNiB94DYgffAyEH4AOCB+EDggfiA4IH4wN6B+QDCAflAqAH5gMIB+cDAgfpA6gH6gOhB+sDqAfsA6gH7QOoB+4DoQfvA6gH8AOoB/EDJgfyA04H8wNcB/UDXAf2A2IH+AMGB/kDBgf6Ap4H+wMCB/wCoQf9AwIH/gL4B/8DYggAAvoIAQNiCAMDYggEAvgIBQNiCAYC+ggHA2IICQNiCAsDaAgMAwIIDQL4CA4DAggQAwYIEQNiCBMC/AgVA2IIFgN1CBcDYggYA2IIHAL5CCEC+AgiAp4IIwNiCCQDYgglAwIIJgNiCCgDJggpAyYISQL5dCsDWnQtA2J0NwNidDgDYnQ5A2h0OgNidDsDYnQ8A1x0PQNidD4DYnQ/A2J0QANidEgDYnRJA2J0SgNidEsDYnRMA2J0TQNidE4DYnRPA2J0UANidFEDXHRSA2J0UwNidFQDYnRVA2J0VgNidFcDYnRYAw50WQNidFoDYnRbA2J0XANcdF0DYnReA2J0XwNidGADYnRhA2J0aAMCdGkDfHRqAwJ0awN8dGwDAnRtA4h0bgKLdG8DgnRwA3x0cQMBdHIDgnRzA3x0dAMJdHUDCXR2AwJ0dwKVdHgClXR5Awh0egMCdHsDSXR8Avx0fQMCdH4DAnR/AwJ0gAKMdIEDAnT5A190+gNhdP4DW3T/A1t1BgNYdQcDAXUIAvp1CQMBdQoDAXULAvp1DAL6dQ0DAXUOAvp1DwMBdRADAXWMA1x3WwVkd1wHWHdk/4h3Zf+Id2f/iHdo/4g='

base64StrToFont(str)*/

const queryParams = (params, url)=> {
	const result = [];
	for (const key in params) {
		result.push(`${key}=${params[key]}`)
	}
	if (url) {
		return `${url}?${result.join('&')}`
	}
	return result.join('&');
};

const getHost = (urlMap, interfaceName)=> {
	for (const key in urlMap) {
		for (const name in urlMap[key]) {
			if (name === interfaceName) {
				return {
					host: key,
					url: `${key}/${urlMap[key][name]}`
				}
			}
		}
	}
	return {
		host: '',
		url: interfaceName
	};
}

const getQueryParams = (url)=> {
	const params = url.split('?')[1];
	const dict = {};
	if (params.length) {
		const arr = params.split('&');
		arr.forEach(item=> {
			const [name, value] = item.split('=');
			dict[name] = value;
		})
	}
	return dict;
}

const sleep = (timeout=5)=> new Promise(resolve => setTimeout(resolve, timeout * 1000))

const interfaceMap = {
	'https://mooc1.chaoxing.com': {
		courseListData: 'visit/courselistdata',
		knowledgeCards: 'knowledge/cards',
		playVideo: 'multimedia/log/a',
		studentStudyAjax: 'mycourse/studentstudyAjax',
		work: 'api/work',
		transfer: 'mycourse/transfer',
		doHomeWorkNew: 'work/doHomeWorkNew'
	},

  'http://i.mooc.chaoxing.com': {
    userInfo: 'space/index'
  },

	'https://mooc2-ans.chaoxing.com': {
		studentCourse: 'mooc2-ans/mycourse/studentcourse'
	},

	'https://mooc1-1.chaoxing.com': {
		courseAll: 'visit/courselistdata'
	}
}

const headers = (Referer)=> {
	const Host = Referer.replace('https://', '');
	return {
		'Content-Type': 'application/json',
		'Cookie': 'fid=12007; lv=2; _uid=150772623; uf=b2d2c93beefa90dc21eccfe46eca2437964bdb84cfc93dcc89685ede0bf814d5274d2bec3fbb23e74fd8e61150650ad9748a002894d7f44e88b83130e7eb4704e0a71ffb2ea94f1f67cc3c653d1ee245db9a01fd759e1b98d6567ff1638bbc3b0d50bf7b93fb11f5; _d=1680853751516; UID=150772623; vc=1517762353A95DAECD070BC1884EDFBC; vc2=734D7734DD556A7A3DD291231008D6DE; vc3=GjIS3Avhd%2F%2Bc5ooqOt9foDpfjAL4goPHE4h05OJSh2f0iIzIihBDNlL9AijFwBPF0Oj78cZE%2FAm3oMcu85tllsVQrpn7ndtH4S3825vbEiV1ny5hXrmWIHn8Ajllu52SQiih6gFv74ehu7wNw%2FbQ5BeSN2X9BdRN6MVA%2FIjCS8A%3D2158bff4a5c77192641eaa79256c5a41; cx_p_token=9c01346147533b9effe1f0ec8215bdb5; xxtenc=32d3e0cb70b51761ee76d6e3cc406f5b; DSSTASH_LOG=C_38-UN_488-US_150772623-T_1680853751518; thirdRegist=0; __utmc=68824131; source=""; k8s=1681438283.667.5689.842768; route=36ef5ecbfa418bb6fd1c82c50e9f0066; __utma=68824131.1687979400.1681438277.1681438277.1681712266.2; __utmz=68824131.1681712266.2.2.utmcsr=baidu|utmccn=(organic)|utmcmd=organic; jrose=BA01773B32017CF11AFFC24E859559E2.mooc2-1953055545-d9phr',
		// 'Referer': 'https://mooc1.chaoxing.com/ananas/modules/video/index.html?v=2023-0331-1824',
		Referer,
		Host,
		'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.0.0 Safari/537.36',
		'sec-ch-ua-mobile': '?0',
		'sec-ch-ua-platform': "macOS",
		"Sec-Fetch-Mode": 'cors',
		'Accept': '*/*',
	}
};

const httpRequest = (req_url, params, method='get')=> {
	method = method.toLowerCase();
	const { url, host } = getHost(interfaceMap, req_url)
	const URL = method === 'get' ? queryParams(params, url) : url;
	console.log(URL)
	return new Promise((resolve, reject) => {
		request({
			url: URL,
			method,
			headers: headers(host),
			form: method === 'get' ? {} : params
		}, (err, res)=> {
			if (!err) return resolve(res.body)
			reject(err);
		})
	})
}

module.exports = {
	sleep,
	queryParams,
	// httpRequest,
	getQueryParams,
	base64StrToFont
};
